<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UbaidBits</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --kb-blue-dark: #0069b8;
      --kb-blue: #00a4ff;
      --kb-blue-soft: #e3f5ff;
      --kb-blue-bg: #0a94df;
      --kb-yellow: #ffc928;
      --kb-yellow-dark: #f5a623;
      --kb-orange: #ff8a3d;
      --kb-green: #59c15b;

      --bg: #0288d1;
      --card: #ffffff;
      --text-main: #163148;
      --text-soft: #60758e;
      --muted: #8aa5c2;
      --error: #e63946;
      --success: #2ecc71;

      --radius-xl: 26px;
      --radius-lg: 20px;
      --radius-md: 14px;
      --shadow-soft: 0 16px 40px rgba(5, 61, 112, 0.35);
      --shadow-small: 0 8px 16px rgba(0, 0, 0, 0.12);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: radial-gradient(circle at top, #35b4ff 0, var(--kb-blue-bg) 45%, #01619b 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 18px;
      color: var(--text-main);
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.08));
      border-radius: 32px;
      padding: 0;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(12px);
      position: relative;
    }

    /* Top bar */
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 24px;
      background: #263238;
      color: #f5f5f5;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 34px;
      height: 34px;
      border-radius: 14px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: #ff5252;
      font-weight: 800;
      box-shadow: 0 6px 12px rgba(0,0,0,0.25);
    }

    .brand-name {
      font-weight: 800;
      letter-spacing: 0.04em;
      font-size: 17px;
    }

    .top-nav {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 13px;
    }

    .top-nav span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      opacity: 0.8;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 999px;
      transition: background 0.15s ease, opacity 0.15s ease;
    }

    .top-nav span:hover {
      background: rgba(255,255,255,0.08);
    }

    .top-nav span.active {
      opacity: 1;
      font-weight: 700;
      background: rgba(255,255,255,0.14);
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 13px;
    }

    .streak-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 999px;
      background: #ff7043;
      color: #fff;
      font-size: 12px;
    }

    .avatar-mini {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #ff5252;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    /* Main layout */
    .app-main {
      padding: 18px 22px 22px;
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 18px;
      background: radial-gradient(circle at top, #3ab8ff 0, #0588d4 40%, #0367a4 100%);
    }

    /* Sidebar */
    .side-menu {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .profile-card {
      background: rgba(255, 255, 255, 0.96);
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      box-shadow: var(--shadow-small);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .profile-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: #ff7043;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: #fff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.3);
    }

    .profile-info { flex: 1; }

    .profile-info h2 {
      font-size: 15px;
      font-weight: 800;
      margin-bottom: 2px;
    }

    .profile-info p {
      font-size: 11px;
      color: var(--text-soft);
    }

    .xp-badge {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 11px;
      font-weight: 700;
      color: #1565c0;
    }

    .xp-main {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--kb-blue-soft);
    }

    .xp-main span.icon { font-size: 14px; }

    .coin-main {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #fff3e0;
      color: #e65100;
      font-size: 11px;
      margin-top: 4px;
    }

    .coin-main .icon {
      font-size: 14px;
    }

    .coin-hint {
      margin-top: 3px;
      font-size: 10px;
      color: #8d6e63;
    }

    .xp-level {
      margin-top: 4px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #00c853;
      color: #fff;
      white-space: nowrap;
    }

    /* BADGE CARD */
    .badge-card {
      background: rgba(255, 255, 255, 0.96);
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      box-shadow: var(--shadow-small);
    }

    .badge-title {
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #546e7a;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge-title span.icon { font-size: 16px; }

    .badge-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .badge-empty {
      font-size: 11px;
      color: #90a4ae;
    }

    .badge-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #e3f5ff;
      border-radius: 999px;
      padding: 5px 8px;
      font-size: 11px;
      color: #1565c0;
      border: 1px solid transparent;
    }

    .badge-chip .emoji { font-size: 16px; }

    .badge-text {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .badge-name {
      font-weight: 800;
      font-size: 11px;
    }

    .badge-desc {
      font-size: 10px;
      color: #607d8b;
    }

    /* Badge color variants */
    .badge-chip.badge-perfectScore1 {
      background: #fff8e1;
      border-color: #ffca28;
      color: #e65100;
    }

    .badge-chip.badge-perfectScore3 {
      background: #ffecb3;
      border-color: #ffc107;
      color: #e65100;
    }

    .badge-chip.badge-perfectScore5 {
      background: #ffe0b2;
      border-color: #ff9800;
      color: #e64a19;
    }

    .badge-chip.badge-perfectScore10 {
      background: linear-gradient(135deg, #ffb300, #ff6f00);
      border-color: #ff8f00;
      color: #ffffff;
    }

    .badge-chip.badge-mathMaster90 {
      background: #e3f2fd;
      border-color: #1e88e5;
      color: #0d47a1;
    }

    .badge-chip.badge-scienceHero90 {
      background: #e8f5e9;
      border-color: #43a047;
      color: #1b5e20;
    }

    .badge-chip.badge-englishChampion90 {
      background: #ede7f6;
      border-color: #7e57c2;
      color: #311b92;
    }

    .badge-progress {
      margin-top: 6px;
      font-size: 11px;
      color: #607d8b;
    }

    .badge-progress strong {
      color: #e65100;
    }

    .side-tile {
      background: rgba(255, 255, 255, 0.96);
      border-radius: var(--radius-lg);
      padding: 12px 14px;
      box-shadow: var(--shadow-small);
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    .side-tile:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.18);
    }

    .side-tile-icon {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: #fff;
      background: #ffb74d;
    }

    .side-tile-text {
      font-size: 13px;
      font-weight: 700;
      color: #263238;
    }

    .side-tile-sub {
      font-size: 11px;
      color: var(--muted);
    }

    /* Main col */
    .main-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* HERO */
    .hero-daily {
      background: #ffce32;
      border-radius: var(--radius-xl);
      padding: 14px 18px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .hero-daily::after {
      content: "";
      position: absolute;
      right: -40px;
      top: -30px;
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.25);
      opacity: 0.6;
    }

    .hero-text h1 {
      font-size: 28px;
      font-weight: 900;
      letter-spacing: 0.03em;
      color: #c05d00;
      margin-bottom: 4px;
    }

    .hero-text p {
      font-size: 13px;
      color: #8b5300;
    }

    .hero-meta {
      margin-top: 4px;
      font-size: 11px;
      color: #8b5300;
      opacity: 0.9;
    }

    .hero-action {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .hero-trophy {
      font-size: 42px;
      filter: drop-shadow(0 4px 6px rgba(199, 125, 0, 0.5));
    }

    #startBtn {
      margin-top: 2px;
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 800;
      cursor: pointer;
      background: linear-gradient(135deg, #ff8a3d, #ff5722);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 18px rgba(204, 96, 0, 0.55);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    #startBtn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 12px 20px rgba(204, 96, 0, 0.7);
    }

    #startBtn:active {
      transform: translateY(0);
      box-shadow: 0 7px 14px rgba(204, 96, 0, 0.6);
    }

    /* Controls */
    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .controls-pill {
      background: rgba(255, 255, 255, 0.96);
      border-radius: 999px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-small);
      font-size: 12px;
      color: var(--text-soft);
    }

    .controls-pill label {
      font-weight: 700;
      color: var(--text-main);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .controls-pill select {
      border: none;
      outline: none;
      background: transparent;
      font-size: 12px;
      color: var(--text-main);
      font-weight: 700;
      padding-right: 4px;
      cursor: pointer;
    }

    .controls-pill select option { color: #000; }

    #homeSection { display: block; }

    .empty-state {
      margin-top: 10px;
      padding: 14px 16px;
      border-radius: var(--radius-lg);
      background: rgba(13, 71, 161, 0.95);
      color: #e3f2fd;
      font-size: 13px;
      display: flex;
      gap: 10px;
      align-items: center;
      box-shadow: var(--shadow-small);
    }

    .empty-state-icon {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .quiz-card {
      margin-top: 10px;
      padding: 14px 16px 16px;
      border-radius: var(--radius-lg);
      background: #ffffff;
      box-shadow: var(--shadow-soft);
    }

    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .quiz-header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tag-row {
      display: flex;
      gap: 6px;
      font-size: 10px;
    }

    .tag-row span {
      padding: 2px 8px;
      border-radius: 999px;
      background: #e3f5ff;
      color: #1565c0;
      font-weight: 700;
    }

    .tag-row span.category {
      background: #ffecb3;
      color: #f57c00;
    }

    .quiz-header h2 {
      font-size: 14px;
      font-weight: 800;
      color: var(--text-main);
    }

    .score-pill {
      font-size: 11px;
      border-radius: 999px;
      background: #ffecb3;
      padding: 5px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #c05d00;
      font-weight: 800;
    }

    .score-pill span.icon { font-size: 14px; }

    .progress-wrapper { margin-bottom: 10px; }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .progress-bar {
      width: 100%;
      height: 9px;
      border-radius: 999px;
      background: #e3f2fd;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00c853, #ffd600);
      border-radius: inherit;
      transition: width 0.25s ease-out;
    }

    .question-text {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 6px;
    }

    .question-image {
      margin: 4px 0 10px;
      text-align: center;
      display: none;
    }

    .question-image img {
      max-width: 100%;
      max-height: 230px;
      border-radius: 14px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.18);
      background: #ffffff;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .option-btn {
      border-radius: var(--radius-md);
      padding: 9px 11px;
      border: 2px solid transparent;
      background: #f9fbff;
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease, background 0.12s ease;
      box-shadow: 0 3px 6px rgba(13, 71, 161, 0.12);
    }

    .option-btn span.option-label {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: #00a4ff;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 12px;
      flex-shrink: 0;
    }

    .option-btn span.option-text { flex: 1; }

    .option-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 10px rgba(13, 71, 161, 0.25);
      border-color: #00a4ff;
      background: #ffffff;
    }

    .option-btn.correct {
      border-color: #2ecc71;
      background: #e8f9f0;
    }

    .option-btn.wrong {
      border-color: #e53935;
      background: #ffebee;
    }

    .option-btn:disabled {
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    /* choiceImage */
    .options.image-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .option-btn.image-option {
      flex-direction: column;
      align-items: stretch;
      padding: 6px;
    }

    .option-btn.image-option .option-label { display: none; }

    .option-img-wrapper {
      width: 100%;
      border-radius: 14px;
      overflow: hidden;
      background: #e3f2fd;
    }

    .option-img-wrapper img {
      width: 100%;
      height: auto;
      display: block;
    }

    .option-caption {
      margin-top: 4px;
      font-size: 11px;
      font-weight: 700;
      color: #1565c0;
      text-align: center;
    }

    /* Input answer (1 atau 3 kolom) */
    .input-answer-row {
      display: none;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .input-group label {
      font-size: 12px;
      font-weight: 700;
      color: #1565c0;
    }

    .input-group input {
      border-radius: 10px;
      padding: 8px 12px;
      border: 2px solid #e3f2fd;
      background: #f9fbff;
      outline: none;
      font-size: 13px;
      color: var(--text-main);
    }

    .input-group input:focus {
      border-color: #00a4ff;
      box-shadow: 0 0 0 1px rgba(33,150,243,0.4);
    }

    #checkInputBtn {
      align-self: flex-start;
      border-radius: 999px;
      border: none;
      padding: 9px 14px;
      font-size: 12px;
      font-weight: 800;
      background: #00c853;
      color: #fff;
      box-shadow: 0 4px 8px rgba(0, 200, 83, 0.4);
      cursor: pointer;
    }

    #checkInputBtn:disabled {
      opacity: 0.7;
      box-shadow: none;
      cursor: default;
    }

    .feedback-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-top: 4px;
    }

    .feedback {
      font-size: 12px;
      min-height: 18px;
    }

    .feedback.correct {
      color: var(--success);
      font-weight: 600;
    }

    .feedback.wrong {
      color: var(--error);
      font-weight: 600;
    }

    .bottom-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    button.secondary {
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 12px;
      font-weight: 700;
      border: none;
      background: #e3f2fd;
      color: #1565c0;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 3px 6px rgba(13, 71, 161, 0.18);
    }

    button.secondary.outline {
      background: #ffffff;
      border: 1px dashed #bbdefb;
      box-shadow: none;
      color: #607d8b;
    }

    button.secondary:hover { background: #bbdefb; }

    button.secondary:disabled {
      opacity: 0.7;
      box-shadow: none;
      cursor: default;
    }

    .result-card { display: none; }

    /* REPORT SECTION */
    #reportSection { display: none; }

    .report-card {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 22px;
      padding: 14px 16px 16px;
      box-shadow: var(--shadow-soft);
    }

    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .report-header h2 {
      font-size: 16px;
      font-weight: 800;
      color: #163148;
    }

    .report-header p {
      font-size: 12px;
      color: var(--text-soft);
    }

    .report-badge {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      background: #e3f5ff;
      color: #1565c0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 700;
    }

    .report-main-grid {
      display: grid;
      grid-template-columns: 2fr 3fr;
      gap: 14px;
      margin-top: 6px;
    }

    .report-chart {
      background: #f5f8ff;
      border-radius: 18px;
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .report-chart-title {
      font-size: 12px;
      font-weight: 700;
      color: #1a237e;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .report-chart-inner {
      height: 160px;
      display: flex;
      align-items: flex-end;
      gap: 6px;
      padding-top: 6px;
    }

    .report-bar {
      flex: 1;
      border-radius: 999px 999px 4px 4px;
      background: linear-gradient(180deg, #ffb300, #ff6f00);
      position: relative;
      min-width: 10px;
    }

    .report-bar.low {
      background: linear-gradient(180deg, #ef9a9a, #e53935);
    }

    .report-bar.mid {
      background: linear-gradient(180deg, #ffecb3, #ffc107);
    }

    .report-bar.high {
      background: linear-gradient(180deg, #a5d6a7, #43a047);
    }

    .report-bar-value {
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 700;
      color: #37474f;
    }

    .report-bar-label {
      font-size: 10px;
      color: #607d8b;
      text-align: center;
      margin-top: 3px;
      white-space: nowrap;
    }

    .report-empty {
      font-size: 12px;
      color: #607d8b;
    }

    .report-table-wrap {
      background: #fdfdfd;
      border-radius: 18px;
      padding: 10px 12px 12px;
      border: 1px solid #e3f2fd;
    }

    .report-table-wrap h3 {
      font-size: 12px;
      font-weight: 700;
      color: #1a237e;
      margin-bottom: 6px;
    }

    table.report-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    table.report-table th,
    table.report-table td {
      padding: 4px 4px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    table.report-table th {
      font-weight: 700;
      color: #455a64;
      background: #f5f5f5;
    }

    table.report-table tr:last-child td { border-bottom: none; }

    table.report-table td.score-cell {
      font-weight: 700;
      color: #1b5e20;
    }

    table.report-table td.score-cell.low { color: #c62828; }
    table.report-table td.score-cell.mid { color: #ef6c00; }

    /* ROBOT LAB SECTION */
    #robotLabSection { display: none; }

    .robotlab-card {
      background: rgba(255,255,255,0.98);
      border-radius: 22px;
      padding: 18px 20px;
      box-shadow: var(--shadow-soft);
    }

    .robotlab-header h2 {
      font-size: 18px;
      font-weight: 800;
      color: #0d47a1;
    }

    .robotlab-header p {
      font-size: 13px;
      color: #455a64;
      margin-top: 2px;
    }

    .robotlab-avatar {
      text-align: center;
      margin: 16px 0;
    }

    .robotlab-robot-emoji {
      font-size: 64px;
      margin-bottom: 6px;
    }

    .robotlab-level-title {
      font-size: 14px;
      font-weight: 700;
      color: #1565c0;
    }

    .robotlab-xpbar {
      margin-top: 12px;
    }

    .robotlab-xpbar-label {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      margin-bottom: 4px;
      color: #455a64;
    }

    .robotlab-xpbar-track {
      height: 12px;
      background: #e3f2fd;
      border-radius: 999px;
      overflow: hidden;
    }

    .robotlab-xpbar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00c853, #ffd600);
      border-radius: inherit;
      transition: width 0.4s ease;
    }

    .robotlab-stats {
      margin-top: 18px;
      display: flex;
      justify-content: space-around;
    }

    .robotlab-stat {
      text-align: center;
    }

    .stat-number {
      font-size: 20px;
      font-weight: 800;
      color: #ff6f00;
    }

    .stat-label {
      font-size: 12px;
      color: #607d8b;
    }

    .robotlab-upgrade-title {
      margin-top: 18px;
      font-size: 14px;
      font-weight: 800;
      color: #1a237e;
    }

    .robotlab-upgrade-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .robotlab-upgrade-item {
      display: flex;
      gap: 10px;
      align-items: center;
      background: #f3f7ff;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid #bbdefb;
    }

    .upgrade-icon {
      font-size: 26px;
    }

    .upgrade-info {
      flex: 1;
    }

    .upgrade-name {
      font-size: 13px;
      font-weight: 700;
      color: #0d47a1;
    }

    .upgrade-status {
      font-size: 11px;
      color: #455a64;
    }

    .upgrade-locked {
      opacity: 0.4;
    }

    /* MODAL NILAI AKHIR & BADGE & GAMES & REWARD */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
      animation: fadeInBg 0.25s ease-out;
    }

    .modal-box {
      background: #ffffff;
      padding: 24px 26px 22px;
      border-radius: 24px;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      position: relative;
      animation: popIn 0.25s ease-out;
    }

    .modal-icon {
      font-size: 42px;
      margin-bottom: 6px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #1565c0;
      margin-bottom: 4px;
    }

    .modal-score {
      font-size: 72px;
      font-weight: 900;
      line-height: 1;
      color: #ff6f00;
      margin: 6px 0 4px;
    }

    .modal-score span {
      font-size: 30px;
      vertical-align: top;
      margin-left: 4px;
    }

    .modal-sub {
      font-size: 13px;
      color: #455a64;
      margin-bottom: 10px;
    }

    .modal-detail {
      font-size: 11px;
      color: #607d8b;
      margin-bottom: 14px;
    }

    .modal-detail strong { color: #37474f; }
.modal-coin-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  margin-bottom: 4px;
}

.modal-coin-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 999px;
  background: linear-gradient(135deg, #ffd54f, #ffb300);
  color: #5d3b00;
  font-weight: 800;
  box-shadow: 0 4px 10px rgba(255, 180, 0, 0.6);
}

.modal-coin-pill span.icon {
  font-size: 18px;
}

.modal-coin-pill span.value {
  font-size: 16px;
}

    .modal-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 4px;
    }

    .modal-btn-primary {
      border-radius: 999px;
      border: none;
      padding: 9px 16px;
      font-size: 12px;
      font-weight: 800;
      background: linear-gradient(135deg, #ff8a3d, #ff5722);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(204, 96, 0, 0.7);
    }

    .modal-btn-secondary {
      border-radius: 999px;
      border: 1px solid #bbdefb;
      padding: 8px 14px;
      font-size: 12px;
      font-weight: 700;
      background: #ffffff;
      color: #1565c0;
      cursor: pointer;
    }

    #badgeModal .modal-box { max-width: 360px; }
    #badgeModal .modal-title { font-size: 17px; }
    #badgeModalEmoji { font-size: 48px; }

    /* SPEED MATH STYLES */
    .speedmath-info-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
    }

    .sm-pill {
      padding: 4px 8px;
      border-radius: 999px;
      background: #e3f2fd;
      font-size: 11px;
      color: #1565c0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .sm-question {
      margin-top: 10px;
      font-size: 16px;
      font-weight: 800;
      color: #163148;
    }

    #smAnswerInput {
      margin-top: 10px;
      width: 100%;
      border-radius: 10px;
      padding: 8px 10px;
      border: 2px solid #e3f2fd;
      background: #f9fbff;
      font-size: 14px;
      outline: none;
    }

    #smAnswerInput:focus {
      border-color: #00a4ff;
      box-shadow: 0 0 0 1px rgba(33,150,243,0.4);
    }

    .sm-feedback {
      min-height: 18px;
      margin-top: 6px;
      font-size: 12px;
      color: #455a64;
    }

    .sm-feedback.correct { color: #2ecc71; font-weight: 600; }
    .sm-feedback.wrong { color: #e53935; font-weight: 600; }

    /* MEMORY GRID STYLES */
    .mg-grid {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(2, 80px);
      gap: 10px;
      justify-content: center;
    }

    .mg-cell {
      width: 80px;
      height: 80px;
      border-radius: 16px;
      background: #e3f2fd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 800;
      color: #1a237e;
      box-shadow: 0 4px 10px rgba(13, 71, 161, 0.25);
    }

    @media (max-width: 400px) {
      .mg-grid {
        grid-template-columns: repeat(2, 70px);
      }
      .mg-cell {
        width: 70px;
        height: 70px;
        font-size: 20px;
      }
    }

    /* REWARD SHOP */
    .reward-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 200px;
      overflow-y: auto;
    }

    .reward-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      background: #f5f7ff;
      border: 1px solid #e0e7ff;
      font-size: 12px;
    }

    .reward-icon {
      font-size: 20px;
    }

    .reward-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .reward-name {
      font-weight: 700;
      color: #1a237e;
    }

    .reward-desc {
      font-size: 11px;
      color: #607d8b;
    }

    .reward-cost {
      font-size: 11px;
      font-weight: 700;
      color: #e65100;
    }

    .reward-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 700;
      background: #ffb300;
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
      box-shadow: 0 3px 6px rgba(245, 124, 0, 0.6);
    }

    .reward-btn:disabled {
      opacity: 0.6;
      box-shadow: none;
      cursor: default;
    }

    .reward-history {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px dashed #c5cae9;
    }

    .reward-history-title {
      font-size: 11px;
      font-weight: 700;
      color: #3949ab;
      margin-bottom: 4px;
    }

    .reward-history-body {
      font-size: 11px;
      color: #607d8b;
      max-height: 120px;
      overflow-y: auto;
    }

    .reward-history-item {
      margin-bottom: 4px;
    }

    /* Animations */
    @keyframes popIn {
      0% {
        opacity: 0;
        transform: scale(0.85) translateY(8px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    @keyframes fadeInBg {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @media (max-width: 900px) {
      .app-main { grid-template-columns: 1fr; }
      .side-menu { order: 2; }
      .main-col { order: 1; }
      .report-main-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 640px) {
      body { padding: 10px; }
      .app-shell { border-radius: 20px; }
      .top-bar {
        flex-wrap: wrap;
        gap: 8px;
        padding-inline: 14px;
      }
      .app-main { padding: 14px; }
      .modal-box { padding: 20px 18px 18px; }
      .modal-score { font-size: 56px; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- TOP BAR -->
    <header class="top-bar">
      <div class="brand">
        <div class="brand-logo">U</div>
        <div class="brand-name">UbaidBits</div>
      </div>
      <nav class="top-nav">
        <span class="active" id="navHome">üè† Home</span>
        <span id="navReport">üìä Report</span>
        <span id="navRobotLab">ü§ñ Robot Lab</span>
      </nav>
    </header>

    <main class="app-main">
      <!-- SIDEBAR -->
      <aside class="side-menu">
        <section class="profile-card">
          <div class="profile-avatar">ü§ñ</div>
          <div class="profile-info">
            <h2>Ubaid Badzil Azkandrias</h2>
            <p>Grade 6 ‚Ä¢ Daily Practice</p>
          </div>
          <div class="xp-badge">
          <div class="xp-main">
  <span class="icon" id="xpIcon">‚≠ê</span>
  <span id="topScore">0 XP</span>
</div>
            <div class="coin-main">
              <span class="icon">ü™ô</span>
              <span id="coinDisplay">0 coins</span>
            </div>
            <div class="xp-level" id="xpLevel">Lv. 1 ‚Ä¢ Starter Bot</div>
          </div>
        </section>

        <!-- BADGE LIST -->
        <section class="badge-card">
          <div class="badge-title">
            <span class="icon">üèÖ</span>
            <span>Badges</span>
          </div>
          <div class="badge-list" id="badgeList">
            <div class="badge-empty">Belum ada badge. Ayo kumpulkan prestasi pertama! üí™</div>
          </div>
          <div class="badge-progress" id="perfectScoreProgress">
            Perfect Score: <strong>0/10</strong> sesi
          </div>
        </section>

        <div class="side-tile" id="brainGamesTile">
          <div class="side-tile-icon">üß†</div>
          <div>
            <div class="side-tile-text">Brain Games</div>
            <div class="side-tile-sub">Speed Math 60 detik</div>
          </div>
        </div>

        <div class="side-tile" id="memoryGridTile">
          <div class="side-tile-icon">üß©</div>
          <div>
            <div class="side-tile-text">Memory Grid</div>
            <div class="side-tile-sub">Ingat posisi 4 angka</div>
          </div>
        </div>

        <div class="side-tile" id="rewardShopTile">
          <div class="side-tile-icon">üéÅ</div>
          <div>
            <div class="side-tile-text">Reward Shop</div>
            <div class="side-tile-sub">Tukar koin emas Ubaid</div>
          </div>
        </div>

        <div class="side-tile">
          <div class="side-tile-icon">üìÖ</div>
          <div>
            <div class="side-tile-text">Events</div>
            <div class="side-tile-sub">Target belajar mingguan</div>
          </div>
        </div>
        <div class="side-tile">
          <div class="side-tile-icon">üìñ</div>
          <div>
            <div class="side-tile-text">Story</div>
            <div class="side-tile-sub">Cerita belajar seru</div>
          </div>
        </div>
      </aside>

      <!-- MAIN COL -->
      <section class="main-col">
        <!-- HOME SECTION -->
        <section id="homeSection">
          <!-- HERO -->
          <section class="hero-daily">
            <div class="hero-text">
              <h1>Examination Primary Grade 6</h1>
              <p>Special practice for Ubaid</p>
              <div class="hero-meta">
                Pilih subject & jumlah soal di bawah, lalu tekan
                <strong>Start</strong>.
              </div>
            </div>
            <div class="hero-action">
              <div class="hero-trophy">üèÜ</div>
              <button id="startBtn">
                Start
                <span>‚ö°</span>
              </button>
            </div>
          </section>

          <!-- CONTROLS -->
          <section class="controls-row" style="margin-top: 6px;">
            <div class="controls-pill">
              <label for="categorySelect">Subject</label>
              <select id="categorySelect">
                <option value="mix">Mix</option>
                <option value="math">Math</option>
                <option value="science">Science</option>
                <option value="english">English</option>
                <option value="global">Global</option>
                <option value="indo">Bhs. Indonesia</option>
                <option value="paibp">PAIBP</option>
                <option value="pancasila">Pend. Pancasila</option>
              </select>
            </div>

            <div class="controls-pill">
              <label for="questionCountSelect">Questions</label>
              <select id="questionCountSelect">
                <option value="5">5 (Quick)</option>
                <option value="10" selected>10 (Standard)</option>
                <option value="15">15 (Challenge)</option>
              </select>
            </div>
          </section>

          <!-- CONTENT AREA -->
          <section id="contentArea">
            <div class="empty-state" id="emptyState">
              <div class="empty-state-icon">‚ú®</div>
              <div>
                <strong>Belum ada latihan yang dimulai.</strong><br />
                Pilih subject & jumlah soal, lalu tekan tombol
                <strong>Start</strong> di kartu kuning di atas.
              </div>
            </div>

            <!-- QUIZ CARD -->
            <section class="quiz-card" id="quizCard" style="display:none;">
              <div class="quiz-header">
                <div class="quiz-header-left">
                  <div class="tag-row">
                    <span id="categoryTag" class="category">Math</span>
                    <span id="questionTag">Question 1 of 10</span>
                  </div>
                  <h2 id="quizTitle">Fokus sebentar, lalu kita rayakan skornya! üéâ</h2>
                </div>
                <div class="score-pill">
                  <span class="icon">‚≠ê</span>
                  <span>Benar sesi ini: <span id="scoreDisplay">0</span></span>
                </div>
              </div>

              <div class="progress-wrapper">
                <div class="progress-label-row">
                  <span id="progressLabel">0% complete</span>
                  <span id="answeredLabel">0 answered</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" id="progressFill"></div>
                </div>
              </div>

              <div class="question-text" id="questionText"></div>
              <div class="question-image" id="questionImageContainer"></div>

              <div class="options" id="optionsContainer"></div>

              <!-- INPUT (1 atau 3 kolom) -->
              <div class="input-answer-row" id="inputContainer">
                <div class="input-group" id="group1">
                  <label id="label1">Answer</label>
                  <input type="text" id="input1" autocomplete="off" />
                </div>
                <div class="input-group" id="group2">
                  <label id="label2">Y</label>
                  <input type="text" id="input2" autocomplete="off" />
                </div>
                <div class="input-group" id="group3">
                  <label id="label3">Z</label>
                  <input type="text" id="input3" autocomplete="off" />
                </div>

                <button id="checkInputBtn">Cek ‚úÖ</button>
              </div>

              <div class="feedback-row">
                <div class="feedback" id="feedback"></div>
                <div class="bottom-actions">
                  <button class="secondary outline" id="skipBtn">Lewati ‚è≠Ô∏è</button>
                  <button class="secondary" id="nextBtn" disabled>Berikutnya ‚ûú</button>
                </div>
              </div>
            </section>

            <!-- RESULT CARD (backup) -->
            <section class="result-card" id="resultCard">
              <div class="result-header">
                <div class="result-main">
                  <h2>
                    <span class="icon" id="emojiResult">üèÜ</span>
                    <span id="resultTitle">Keren, Ubaid!</span>
                  </h2>
                  <p id="resultMessage">
                    Kamu sudah menyelesaikan semua soal.
                  </p>
                </div>
                <div class="result-score">
                  Total Score<br />
                  <strong><span id="resultScore">0</span></strong>
                  <span style="font-size:12px;">/ <span id="resultMaxScore">100</span></span>
                </div>
              </div>

              <div class="result-details">
                <div class="chip">
                  <span class="icon">‚úÖ</span>
                  Benar:
                  <span id="resultCorrect">0</span>
                </div>
                <div class="chip">
                  <span class="icon">‚ùå</span>
                  Salah:
                  <span id="resultWrong">0</span>
                </div>
                <div class="chip">
                  <span class="icon">‚è≠Ô∏è</span>
                  Dilewati:
                  <span id="resultSkipped">0</span>
                </div>
                <div class="chip">
                  <span class="icon">üìä</span>
                  Persentase:
                  <span id="resultPercent">0%</span>
                </div>
              </div>

              <div class="result-actions">
                <button class="secondary outline" id="backToStartBtn">
                  üîÅ Kembali ke Daily Challenge
                </button>
                <button class="secondary" id="retryBtn">
                  üîÑ Ulangi sesi ini
                </button>
              </div>
            </section>
          </section>
        </section>

        <!-- RAPOR SECTION -->
        <section id="reportSection">
          <section class="report-card">
            <div class="report-header">
              <div>
                <h2>Rapor Ubaid</h2>
                <p>Grafik dan ringkasan nilai setiap sesi latihan.</p>
              </div>
              <div class="report-badge">
                <span>üìà</span>
                <span id="reportSummary">Belum ada sesi</span>
              </div>
            </div>

            <div class="report-main-grid">
              <div class="report-chart">
                <div class="report-chart-title">
                  <span>Perkembangan Nilai (maks 10 sesi terakhir)</span>
                  <span style="font-size:10px;color:#607d8b;">Tinggi batang = nilai %</span>
                </div>
                <div id="reportChartInner" class="report-chart-inner">
                  <div class="report-empty" id="reportChartEmpty">
                    Belum ada data. Selesaikan minimal satu sesi latihan dulu.
                  </div>
                </div>
              </div>

              <div class="report-table-wrap">
                <h3>Detail Sesi Latihan</h3>
                <div id="reportTableEmpty" class="report-empty">
                  Belum ada sesi yang tercatat.
                </div>
                <table class="report-table" id="reportTable" style="display:none;">
                  <thead>
                    <tr>
                      <th>Tanggal</th>
                      <th>Subject</th>
                      <th>Nilai</th>
                      <th>Benar / Total</th>
                    </tr>
                  </thead>
                  <tbody id="reportTableBody"></tbody>
                </table>
              </div>
            </div>
          </section>
        </section>

        <!-- ROBOT LAB SECTION -->
        <section id="robotLabSection">
          <section class="robotlab-card">
            <div class="robotlab-header">
              <h2>Robot Lab</h2>
              <p>Tingkatkan robot UbaidBits melalui XP & Level!</p>
            </div>

            <div class="robotlab-avatar">
              <div class="robotlab-robot-emoji" id="robotLabEmoji">ü§ñ</div>
              <div class="robotlab-level-title" id="robotLabLevelTitle">Lv. 1 ‚Äî Starter Bot</div>
            </div>

            <div class="robotlab-xpbar">
              <div class="robotlab-xpbar-label">
                <span id="robotLabXPLabel">0 XP</span>
                <span id="robotLabNextLevel">Next upgrade: 10 XP</span>
              </div>
              <div class="robotlab-xpbar-track">
                <div class="robotlab-xpbar-fill" id="robotLabXPFill"></div>
              </div>
            </div>

            <div class="robotlab-stats">
              <div class="robotlab-stat">
                <div class="stat-number" id="statTotalXP">0</div>
                <div class="stat-label">Total XP</div>
              </div>
              <div class="robotlab-stat">
                <div class="stat-number" id="statTotalSessions">0</div>
                <div class="stat-label">Total Sessions</div>
              </div>
              <div class="robotlab-stat">
                <div class="stat-number" id="statPerfectScore">0</div>
                <div class="stat-label">Perfect Score</div>
              </div>
            </div>

            <div class="robotlab-upgrade-title">Robot Upgrades</div>
            <div class="robotlab-upgrade-list" id="robotLabUpgradeList"></div>
          </section>
        </section>
      </section>
    </main>

    <!-- MODAL NILAI AKHIR -->
    <div class="modal-overlay" id="resultModal">
      <div class="modal-box">
        <div class="modal-icon" id="modalEmoji">üèÜ</div>
        <div class="modal-title">NILAI AKHIR</div>
        <div class="modal-score" id="modalScore">100<span>%</span></div>
        <div class="modal-sub">
          <span id="modalMessageShort">Keren banget, Ubaid!</span>
        </div>
        <div class="modal-detail">
          Benar: <strong><span id="modalCorrect">0</span></strong> ‚Ä¢
          Salah: <strong><span id="modalWrong">0</span></strong> ‚Ä¢
          Dilewati: <strong><span id="modalSkipped">0</span></strong>
        </div>
                <!-- Coins session ini -->
        <div class="modal-coin-row">
          <div class="modal-coin-pill">
            <span class="icon">ü™ô</span>
            <span>Coins: <span class="value" id="modalCoinValue">+0</span></span>
          </div>
        </div>
        <div class="modal-detail" id="modalCoinExplain">
          0 soal benar √ó 50 coins = 0 coins
        </div>

        <div class="modal-buttons">
          <button class="modal-btn-primary" id="modalRetryBtn">
            üîÑ Ulangi sesi ini
          </button>
          <button class="modal-btn-secondary" id="modalCloseBtn">
            üè† Kembali ke Daily Challenge
          </button>
        </div>
      </div>
    </div>

    <!-- BADGE POPUP -->
    <div class="modal-overlay" id="badgeModal" style="display:none;">
      <div class="modal-box">
        <div class="modal-icon" id="badgeModalEmoji">üèÖ</div>
        <div class="modal-title" id="badgeModalTitle">Badge Unlocked!</div>
        <div class="modal-sub" id="badgeModalDesc">Keterangan badge.</div>
        <div class="modal-buttons" style="margin-top:12px;">
          <button class="modal-btn-primary" id="badgeModalOkBtn">OK ‚úî</button>
        </div>
      </div>
    </div>

    <!-- SPEED MATH MODAL -->
    <div class="modal-overlay" id="speedMathModal" style="display:none;">
      <div class="modal-box">
        <div class="modal-icon">‚ö°</div>
        <div class="modal-title">Speed Math 60s</div>
        <div class="speedmath-info-row">
          <div class="sm-pill">‚è±Ô∏è <span id="smTimer">60s</span></div>
          <div class="sm-pill">Score: <span id="smScore">0</span></div>
          <div class="sm-pill">Best: <span id="smHighScore">0</span></div>
        </div>
        <div class="sm-question" id="smQuestion">Tekan Start untuk mulai.</div>
        <input id="smAnswerInput" type="number" placeholder="Jawaban..." />
        <div class="sm-feedback" id="smFeedback"></div>
        <div class="modal-buttons">
          <button class="modal-btn-primary" id="smStartBtn">Start</button>
          <button class="modal-btn-secondary" id="smSubmitBtn" disabled>Submit</button>
          <button class="modal-btn-secondary" id="smCloseBtn">Close</button>
        </div>
      </div>
    </div>

    <!-- MEMORY GRID MODAL -->
    <div class="modal-overlay" id="memoryGridModal" style="display:none;">
      <div class="modal-box">
        <div class="modal-icon">üß©</div>
        <div class="modal-title">Memory Grid</div>
        <div class="speedmath-info-row">
          <div class="sm-pill">Round: <span id="mgRoundLabel">0/5</span></div>
          <div class="sm-pill">Score: <span id="mgScoreLabel">0</span></div>
          <div class="sm-pill">Best: <span id="mgBestLabel">0</span></div>
        </div>
        <div class="mg-grid" id="mgGrid">
          <div class="mg-cell" data-index="0"></div>
          <div class="mg-cell" data-index="1"></div>
          <div class="mg-cell" data-index="2"></div>
          <div class="mg-cell" data-index="3"></div>
        </div>
        <div class="sm-question" id="mgQuestion">Tekan Start untuk mulai.</div>
        <div class="options" id="mgOptionsContainer" style="margin-top:8px;"></div>
        <div class="sm-feedback" id="mgFeedback"></div>
        <div class="modal-buttons">
          <button class="modal-btn-primary" id="mgStartBtn">Start</button>
          <button class="modal-btn-secondary" id="mgNextBtn" disabled>Next</button>
          <button class="modal-btn-secondary" id="mgCloseBtn">Close</button>
        </div>
      </div>
    </div>

    <!-- REWARD SHOP MODAL -->
    <div class="modal-overlay" id="rewardShopModal" style="display:none;">
      <div class="modal-box">
        <div class="modal-icon">üéÅ</div>
        <div class="modal-title">Reward Shop</div>
        <div class="modal-sub">
          Tukar koin emas Ubaid dengan hadiah di dunia nyata.
          <br>Minimal penukaran 5000 coins.
        </div>

        <div class="reward-list" id="rewardList"></div>

        <div class="reward-history">
          <div class="reward-history-title">Riwayat penukaran</div>
          <div class="reward-history-body" id="rewardHistory">
            Belum ada penukaran.
          </div>
        </div>

        <div class="modal-buttons" style="margin-top:12px;">
          <button class="modal-btn-secondary" id="rewardCloseBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==============================
    // BANK SOAL
    // ==============================
    const questionBank = {
      math: [
        {
          type: "choice",
          question: "Pick the prime number",
          options: ["4", "7", "8", "9"],
          answerIndex: 1,
          explanation: "Bilangan prima adalah bilangan yang hanya bisa dibagi 1 dan dirinya sendiri."
        },
        {
          type: "input",
          question: "3/4 + 2/3 = ....",
          correctAnswers: ["17/12", "1 5/12"],
          explanation: "Samakan penyebut: 3/4 = 9/12 dan 2/3 = 8/12. Hasilnya 17/12."
        },
        {
          type: "choice",
          question: "Area of triangle with base 10 cm and height 6 cm = .... cm¬≤",
          options: ["15", "30", "60", "120"],
          answerIndex: 1,
          explanation: "Luas segitiga = 1/2 √ó alas √ó tinggi = 1/2 √ó 10 √ó 6 = 30 cm¬≤."
        },
        {
          type: "choice",
          question: "Perimeter of rectangle 6 cm x 4 cm = .... cm",
          options: ["10", "12", "20", "24"],
          answerIndex: 2,
          explanation: "Keliling persegi panjang = 2 √ó (panjang + lebar) = 2 √ó (6 + 4) = 20 cm."
        },
        {
          type: "choice",
          question: "1,5 km = .... m",
          options: ["150 m", "1500 m", "15000 m", "15 m"],
          answerIndex: 1,
          explanation: "1 km = 1000 m, jadi 1,5 km = 1,5 √ó 1000 m = 1500 m."
        },
        {
          type: "input",
          question: "1/4 + 2/3 = .... (jawab dalam bentuk pecahan biasa)",
          correctAnswers: ["11/12"],
          explanation: "Samakan penyebut 1/4 = 3/12 dan 2/3 = 8/12, sehingga 3/12 + 8/12 = 11/12."
        },
        {
          type: "choice",
          question: "What is 25% of 80?",
          options: ["15", "18", "20", "25"],
          answerIndex: 2,
          explanation: "25% dari 80 adalah 1/4 √ó 80 = 20."
        },
        {
          type: "choice",
          question: "Hasil dari 0,6 dalam bentuk pecahan adalah ....",
          options: ["3/10", "6/10", "3/5", "2/3"],
          answerIndex: 2,
          explanation: "0,6 = 6/10 dan jika disederhanakan menjadi 3/5."
        },
        {
          type: "choice",
          question: "Jika sebuah pola bilangan: 3, 6, 12, 24, ... , ... maka dua suku berikutnya adalah ....",
          options: ["48, 96", "36, 72", "30, 60", "50, 100"],
          answerIndex: 0,
          explanation: "Setiap suku dikali 2: 3√ó2=6, 6√ó2=12, 12√ó2=24, maka berikutnya 24√ó2=48 dan 48√ó2=96."
        },
        {
          type: "choice",
          question: "4(2b + 3) when b = 5 equals ....",
          options: ["52", "40", "26", "13"],
          answerIndex: 0,
          explanation: "4(2√ó5 + 3) = 4(10 + 3) = 4√ó13 = 52."
        }
      ],

      science: [
        {
          type: "choice",
          question: "Bagian tumbuhan yang berfungsi menyerap air dan mineral dari tanah adalah ...",
          options: ["Daun", "Batang", "Akar", "Bunga"],
          answerIndex: 2,
          explanation: "Akar menyerap air dan mineral dari tanah."
        },
        {
          type: "choice",
          question: "Perubahan wujud dari air menjadi uap air disebut ...",
          options: ["Mencair", "Menguap", "Membeku", "Mengkristal"],
          answerIndex: 1,
          explanation: "Air yang menjadi uap air disebut menguap (evaporasi)."
        },
        {
          type: "choice",
          question: "Organ pernapasan utama pada manusia adalah ...",
          options: ["Hidung", "Trakea", "Paru-paru", "Mulut"],
          answerIndex: 2,
          explanation: "Paru-paru adalah organ utama pernapasan manusia."
        },
        {
          type: "choice",
          question: "Benda yang dapat ditarik paling kuat oleh magnet adalah ...",
          options: ["Plastik", "Kertas", "Besi", "Kaca"],
          answerIndex: 2,
          explanation: "Besi termasuk bahan feromagnetik yang kuat ditarik magnet."
        },
        {
          type: "choice",
          question: "Matahari terbit dari arah ... dan tenggelam di arah ...",
          options: ["Barat - Timur", "Timur - Barat", "Utara - Selatan", "Selatan - Utara"],
          answerIndex: 1,
          explanation: "Matahari terbit di Timur dan tenggelam di Barat."
        },
        {
          type: "input",
          question: "Sebutkan wujud air pada suhu di atas 100¬∞C (tulis satu kata saja)!",
          correctAnswers: ["uap", "gas", "uap air"],
          explanation: "Pada suhu di atas 100¬∞C, air berwujud gas (uap air)."
        },
        {
          type: "input3",
          question: "Which are the correct names of the organs labelled X, Y, and Z?",
          image: "https://raw.githubusercontent.com/andyandriadoria/UbaidBits/main/Picture2.png",
          labels: ["X", "Y", "Z"],
          correctAnswers: [
            ["left lung", "lung kiri", "paru kiri", "paru-paru kiri"],
            ["right lung", "lung kanan", "paru kanan", "paru-paru kanan"],
            ["heart", "jantung"]
          ],
          explanation: "X = left lung, Y = right lung, Z = heart."
        }
      ],

      english: [
        {
          type: "choice",
          question: "Which one is a noun?",
          options: ["Run", "Happy", "Teacher", "Quickly"],
          answerIndex: 2,
          explanation: "Teacher adalah kata benda (noun)."
        },
        {
          type: "choice",
          question: "Choose the correct sentence:",
          options: [
            "He don't like apples.",
            "He doesn't like apples.",
            "He doesn't likes apples.",
            "He not like apples."
          ],
          answerIndex: 1,
          explanation: "Kalimat yang benar: He doesn't like apples."
        },
        {
          type: "input",
          question: "Fill in the blank: She ____ (go) to school every day.",
          correctAnswers: ["goes"],
          explanation: "Untuk she/he/it, kata kerja biasanya ditambah -es: goes."
        },
        {
          type: "choice",
          question: "Complete the sentence: Arabang and ‚Ä¶. were amazed by the baby elephants.",
          options: ["I", "me", "My", "Mine"],
          answerIndex: 0,
          explanation: "Karena menjadi bagian dari subjek (Arabang and I), maka yang digunakan adalah I."
        },
        {
          type: "choice",
          question: "It was an amazing experience for ‚Ä¶. and the rest of the group.",
          options: ["I", "me", "My", "Mine"],
          answerIndex: 1,
          explanation: "Setelah preposisi (for), kita menggunakan objek 'me'."
        },
        {
          type: "choice",
          question: "The elephants were unaware that ‚Ä¶. was watching them.",
          options: ["I", "me", "My", "Mine"],
          answerIndex: 0,
          explanation: "Di sini yang berfungsi sebagai subjek (was watching) adalah 'I'."
        },
        {
          type: "input3",
          question: "Complete with I or me: X, Y, and Z.",
          labels: ["X", "Y", "Z"],
          correctAnswers: [
            ["I", "i"],
            ["Me", "me"],
            ["I", "i"]
          ],
          explanation: "Gunakan I ketika sebagai subjek, dan me sebagai objek."
        }
      ],

      global: [
        {
          type: "choice",
          question: "Benua manakah yang terbesar di dunia?",
          options: ["Eropa", "Asia", "Afrika", "Australia"],
          answerIndex: 1,
          explanation: "Benua terbesar di dunia adalah Asia."
        },
        {
          type: "choice",
          question: "Organisasi internasional yang beranggotakan hampir semua negara di dunia adalah ...",
          options: ["ASEAN", "Uni Eropa", "PBB", "NATO"],
          answerIndex: 2,
          explanation: "PBB (Perserikatan Bangsa-Bangsa) beranggotakan hampir semua negara di dunia."
        }
      ],

      indo: [
        {
          type: "choice",
          question: "Kalimat manakah yang menggunakan huruf kapital dengan benar?",
          options: [
            "aku tinggal di kota pangkalpinang.",
            "Saya tinggal di kota pangkalpinang.",
            "Saya tinggal di Kota pangkalpinang.",
            "saya Tinggal di Kota Pangkalpinang."
          ],
          answerIndex: 1,
          explanation: "Huruf kapital di awal kalimat dan untuk nama diri 'Saya'."
        },
        {
          type: "input",
          question: "Antonim dari kata 'tinggi' adalah ....",
          correctAnswers: ["rendah"],
          explanation: "Kebalikan dari tinggi adalah rendah."
        }
      ],

      paibp: [
        {
          type: "choice",
          question: "Rukun Islam yang pertama adalah ...",
          options: [
            "Mendirikan salat",
            "Mengucapkan dua kalimat syahadat",
            "Puasa di bulan Ramadan",
            "Menunaikan zakat"
          ],
          answerIndex: 1,
          explanation: "Rukun Islam yang pertama adalah mengucapkan dua kalimat syahadat."
        },
        {
          type: "choice",
          question: "Sifat terpuji yang berarti jujur dalam perkataan dan perbuatan disebut ...",
          options: ["Syaja'ah", "Amanah", "Siddiq", "Tabligh"],
          answerIndex: 2,
          explanation: "Siddiq artinya jujur."
        }
      ],

      pancasila: [
        {
          type: "choice",
          question: "Sila ke-3 Pancasila berbunyi ...",
          options: [
            "Ketuhanan Yang Maha Esa",
            "Kemanusiaan yang adil dan beradab",
            "Persatuan Indonesia",
            "Kerakyatan yang dipimpin oleh hikmat kebijaksanaan dalam permusyawaratan/perwakilan"
          ],
          answerIndex: 2,
          explanation: "Sila ke-3 adalah 'Persatuan Indonesia'."
        },
        {
          type: "choice",
          question: "Contoh sikap yang sesuai dengan sila ke-3 Pancasila adalah ...",
          options: [
            "Menghormati teman yang berbeda suku",
            "Beribadah sesuai agama masing-masing",
            "Bermusyawarah dalam mengambil keputusan",
            "Menolong tetangga yang kesusahan"
          ],
          answerIndex: 0,
          explanation: "Menghormati perbedaan suku menunjukkan sikap persatuan dan kesatuan."
        }
      ]
    };

    function getMixedQuestions() {
      return [
        ...questionBank.math,
        ...questionBank.science,
        ...questionBank.english,
        ...questionBank.global,
        ...questionBank.indo,
        ...questionBank.paibp,
        ...questionBank.pancasila
      ];
    }

    // ==============================
    // STATE & ELEMENTS
    // ==============================
    let currentQuestions = [];
    let currentIndex = 0;

    let sessionCorrect = 0;
    let totalXP = 0;
    let totalCoins = 0; // koin emas
    let answeredCount = 0;
    let skippedCount = 0;
    let isQuestionLocked = false;
    let startingLevel = 1;
    let currentCategory = "mix";

    let unlockedBadges = [];
    let totalAnsweredAllTime = 0;
    let badgeQueue = [];
    let isShowingBadgePopup = false;
    let rewardHistory = [];

    const categorySelect = document.getElementById("categorySelect");
    const questionCountSelect = document.getElementById("questionCountSelect");
    const startBtn = document.getElementById("startBtn");

    const emptyState = document.getElementById("emptyState");
    const quizCard = document.getElementById("quizCard");
    const resultCard = document.getElementById("resultCard");

    const categoryTag = document.getElementById("categoryTag");
    const questionTag = document.getElementById("questionTag");
    const quizTitle = document.getElementById("quizTitle");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const topScore = document.getElementById("topScore");
    const xpIcon = document.getElementById("xpIcon");
    const xpLevel = document.getElementById("xpLevel");
    const coinDisplay = document.getElementById("coinDisplay");
    const coinHint = document.getElementById("coinHint");

    const progressFill = document.getElementById("progressFill");
    const progressLabel = document.getElementById("progressLabel");
    const answeredLabel = document.getElementById("answeredLabel");

    const questionText = document.getElementById("questionText");
    const questionImageContainer = document.getElementById("questionImageContainer");
    const optionsContainer = document.getElementById("optionsContainer");

    const inputContainer = document.getElementById("inputContainer");
    const input1 = document.getElementById("input1");
    const input2 = document.getElementById("input2");
    const input3 = document.getElementById("input3");
    const group2 = document.getElementById("group2");
    const group3 = document.getElementById("group3");
    const label1 = document.getElementById("label1");
    const label2 = document.getElementById("label2");
    const label3 = document.getElementById("label3");
    const checkInputBtn = document.getElementById("checkInputBtn");
    const feedback = document.getElementById("feedback");

    const nextBtn = document.getElementById("nextBtn");
    const skipBtn = document.getElementById("skipBtn");

    const emojiResult = document.getElementById("emojiResult");
    const resultTitle = document.getElementById("resultTitle");
    const resultMessage = document.getElementById("resultMessage");
    const resultScore = document.getElementById("resultScore");
    const resultMaxScore = document.getElementById("resultMaxScore");
    const resultCorrect = document.getElementById("resultCorrect");
    const resultWrong = document.getElementById("resultWrong");
    const resultSkipped = document.getElementById("resultSkipped");
    const resultPercent = document.getElementById("resultPercent");

    const backToStartBtn = document.getElementById("backToStartBtn");
    const retryBtn = document.getElementById("retryBtn");

    const resultModal = document.getElementById("resultModal");
    const modalScore = document.getElementById("modalScore");
    const modalEmoji = document.getElementById("modalEmoji");
    const modalMessageShort = document.getElementById("modalMessageShort");
    const modalCorrect = document.getElementById("modalCorrect");
    const modalWrong = document.getElementById("modalWrong");
    const modalSkipped = document.getElementById("modalSkipped");
    const modalCoinValue = document.getElementById("modalCoinValue");
    const modalCoinExplain = document.getElementById("modalCoinExplain");
    const coinSound = document.getElementById("coinSound");
    const modalRetryBtn = document.getElementById("modalRetryBtn");
    const modalCloseBtn = document.getElementById("modalCloseBtn");

    const navHome = document.getElementById("navHome");
    const navReport = document.getElementById("navReport");
    const navRobotLab = document.getElementById("navRobotLab");
    const homeSection = document.getElementById("homeSection");
    const reportSection = document.getElementById("reportSection");
    const robotLabSection = document.getElementById("robotLabSection");

    const reportSummary = document.getElementById("reportSummary");
    const reportChartInner = document.getElementById("reportChartInner");
    const reportChartEmpty = document.getElementById("reportChartEmpty");
    const reportTable = document.getElementById("reportTable");
    const reportTableBody = document.getElementById("reportTableBody");
    const reportTableEmpty = document.getElementById("reportTableEmpty");

    const badgeList = document.getElementById("badgeList");
    const perfectScoreProgressEl = document.getElementById("perfectScoreProgress");
    const badgeModal = document.getElementById("badgeModal");
    const badgeModalEmoji = document.getElementById("badgeModalEmoji");
    const badgeModalTitle = document.getElementById("badgeModalTitle");
    const badgeModalDesc = document.getElementById("badgeModalDesc");
    const badgeModalOkBtn = document.getElementById("badgeModalOkBtn");

    // Robot Lab elements
    const robotLabEmoji = document.getElementById("robotLabEmoji");
    const robotLabLevelTitle = document.getElementById("robotLabLevelTitle");
    const robotLabXPLabel = document.getElementById("robotLabXPLabel");
    const robotLabNextLevel = document.getElementById("robotLabNextLevel");
    const robotLabXPFill = document.getElementById("robotLabXPFill");
    const statTotalXP = document.getElementById("statTotalXP");
    const statTotalSessions = document.getElementById("statTotalSessions");
    const statPerfectScore = document.getElementById("statPerfectScore");
    const robotLabUpgradeList = document.getElementById("robotLabUpgradeList");

    // Brain Games / Speed Math elements
    const brainGamesTile = document.getElementById("brainGamesTile");
    const speedMathModal = document.getElementById("speedMathModal");
    const smTimerEl = document.getElementById("smTimer");
    const smScoreEl = document.getElementById("smScore");
    const smHighScoreEl = document.getElementById("smHighScore");
    const smQuestionEl = document.getElementById("smQuestion");
    const smAnswerInput = document.getElementById("smAnswerInput");
    const smFeedback = document.getElementById("smFeedback");
    const smStartBtn = document.getElementById("smStartBtn");
    const smSubmitBtn = document.getElementById("smSubmitBtn");
    const smCloseBtn = document.getElementById("smCloseBtn");

    // Memory Grid elements
    const memoryGridTile = document.getElementById("memoryGridTile");
    const memoryGridModal = document.getElementById("memoryGridModal");
    const mgGrid = document.getElementById("mgGrid");
    const mgCells = mgGrid ? Array.from(mgGrid.querySelectorAll(".mg-cell")) : [];
    const mgQuestion = document.getElementById("mgQuestion");
    const mgOptionsContainer = document.getElementById("mgOptionsContainer");
    const mgFeedback = document.getElementById("mgFeedback");
    const mgStartBtn = document.getElementById("mgStartBtn");
    const mgNextBtn = document.getElementById("mgNextBtn");
    const mgCloseBtn = document.getElementById("mgCloseBtn");
    const mgRoundLabel = document.getElementById("mgRoundLabel");
    const mgScoreLabel = document.getElementById("mgScoreLabel");
    const mgBestLabel = document.getElementById("mgBestLabel");

    // Reward Shop elements
    const rewardShopTile = document.getElementById("rewardShopTile");
    const rewardShopModal = document.getElementById("rewardShopModal");
    const rewardListEl = document.getElementById("rewardList");
    const rewardHistoryEl = document.getElementById("rewardHistory");
    const rewardCloseBtn = document.getElementById("rewardCloseBtn");

    // Speed Math state
    let smTimeLeft = 60;
    let smScore = 0;
    let smHighScore = 0;
    let smTimerInterval = null;
    let smCurrentAnswer = null;
    let smInProgress = false;

    // Memory Grid state
    let mgTotalRounds = 5;
    let mgCurrentRound = 0;
    let mgScore = 0;
    let mgBestScore = 0;
    let mgNumbers = [];
    let mgTargetIndex = 0;
    let mgCorrectNumber = 0;
    let mgPhase = "idle"; // 'idle' | 'show' | 'question' | 'answer' | 'done'
    let mgTimeoutId = null;

    // ==============================
    // XP LEVEL & BADGE CONFIG
    // ==============================
    const LEVELS = [
      { minXP: 0,  maxXP: 9,   level: 1, title: "Starter Bot",       emoji: "ü§ñ" },
      { minXP: 10, maxXP: 24,  level: 2, title: "Number Scout",      emoji: "üßÆ" },
      { minXP: 25, maxXP: 49,  level: 3, title: "Fraction Ranger",   emoji: "üß†" },
      { minXP: 50, maxXP: 99,  level: 4, title: "Math Commander",    emoji: "‚ö°" },
      { minXP: 100,maxXP: 9999,level: 5, title: "UbaidBits Legend",  emoji: "üåü" }
    ];

    const BADGES = [
      {
        id: "perfectScore1",
        name: "Perfect Score x1",
        description: "Mendapat nilai 100% dalam 1 sesi.",
        emoji: "üåü"
      },
      {
        id: "perfectScore3",
        name: "Perfect Score x3",
        description: "Mendapat nilai 100% dalam 3 sesi.",
        emoji: "üåüüåü"
      },
      {
        id: "perfectScore5",
        name: "Perfect Score x5",
        description: "Mendapat nilai 100% dalam 5 sesi.",
        emoji: "üåüüåüüåü"
      },
      {
        id: "perfectScore10",
        name: "Perfect Score x10",
        description: "Mendapat nilai 100% dalam 10 sesi.",
        emoji: "üëë"
      },
      {
        id: "mathMaster90",
        name: "Math Master",
        description: "Nilai ‚â• 90% di kategori Math.",
        emoji: "‚ûó"
      },
      {
        id: "scienceHero90",
        name: "Science Explorer",
        description: "Nilai ‚â• 90% di kategori Science.",
        emoji: "üî¨"
      },
      {
        id: "englishChampion90",
        name: "English Champion",
        description: "Nilai ‚â• 90% di kategori English.",
        emoji: "üìò"
      }
    ];

    // Reward items
    const REWARDS = [
      {
        id: "snack",
        name: "Snack Spesial & Uang Rp 5.000",
        cost: 5000,
        desc: "Boleh pilih 1 snack favorit di toko dan mendapat uang Rp 5.000."
      },
      {
        id: "book",
        name: "Buku Baru & Uang Rp 10.000",
        cost: 10000,
        desc: "1 buku baru yang dipilih bersama dan mendapat uang Rp 10.000."
      },
            {
        id: "toy",
        name: "Mainan Baru & Uang Rp 50.000",
        cost: 50000,
        desc: "1 mainan baru yang dipilih bersama dan mendapat uang Rp 50.000."
      }
    ];

    function getLevelInfo(xp) {
      for (const lvl of LEVELS) {
        if (xp >= lvl.minXP && xp <= lvl.maxXP) return lvl;
      }
      return LEVELS[LEVELS.length - 1];
    }

    function updateXPUI(info) {
      topScore.textContent = totalXP + " XP";
      xpLevel.textContent = "Lv. " + info.level + " ‚Ä¢ " + info.title;
      xpIcon.textContent = info.emoji;
    }

    function initXP() {
      const saved = localStorage.getItem("ubaidXP");
      totalXP = saved ? parseInt(saved, 10) || 0 : 0;
      const info = getLevelInfo(totalXP);
      updateXPUI(info);
    }

    function updateCoinUI() {
      if (coinDisplay) {
        coinDisplay.textContent = totalCoins + " coins";
      }
      if (coinHint) {
        if (totalCoins >= 5000) {
          coinHint.textContent = "Ready to redeem! üéÅ (‚â• 5000 coins)";
        } else {
          const remain = 5000 - totalCoins;
          coinHint.textContent = "Min redeem: 5000 coins (kurang " + remain + ")";
        }
      }
    }

    function initCoins() {
      const saved = localStorage.getItem("ubaidCoins");
      totalCoins = saved ? parseInt(saved, 10) || 0 : 0;
      updateCoinUI();
    }

    // BADGES
    function loadBadges() {
      const raw = localStorage.getItem("ubaidBadges");
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }

    function saveBadges() {
      localStorage.setItem("ubaidBadges", JSON.stringify(unlockedBadges));
    }

    function initTotalAnswered() {
      const raw = localStorage.getItem("ubaidTotalAnswered");
      totalAnsweredAllTime = raw ? parseInt(raw, 10) || 0 : 0;
    }

    function saveTotalAnswered() {
      localStorage.setItem("ubaidTotalAnswered", String(totalAnsweredAllTime));
    }

    function getBadgeConfigById(id) {
      return BADGES.find(b => b.id === id);
    }

    function renderBadges() {
      badgeList.innerHTML = "";
      if (!unlockedBadges.length) {
        const div = document.createElement("div");
        div.className = "badge-empty";
        div.textContent = "Belum ada badge. Ayo kumpulkan prestasi pertama! üí™";
        badgeList.appendChild(div);
      } else {
        unlockedBadges.forEach(id => {
          const cfg = getBadgeConfigById(id);
          if (!cfg) return;
          const chip = document.createElement("div");
          chip.className = "badge-chip badge-" + id;
          chip.innerHTML = `
            <span class="emoji">${cfg.emoji}</span>
            <div class="badge-text">
              <div class="badge-name">${cfg.name}</div>
              <div class="badge-desc">${cfg.description}</div>
            </div>
          `;
          badgeList.appendChild(chip);
        });
      }
      updatePerfectScoreProgressUI();
    }

    function unlockBadge(id) {
      if (!unlockedBadges.includes(id)) {
        unlockedBadges.push(id);
        saveBadges();
        renderBadges();
        return true;
      }
      return false;
    }

    // BADGE POPUP QUEUE
    function showNextBadgePopup() {
      if (isShowingBadgePopup) return;
      if (badgeQueue.length === 0) return;

      const nextBadgeId = badgeQueue.shift();
      const cfg = getBadgeConfigById(nextBadgeId);
      if (!cfg) return;

      badgeModalEmoji.textContent = cfg.emoji;
      badgeModalTitle.textContent = cfg.name;
      badgeModalDesc.textContent = cfg.description;

      badgeModal.style.display = "flex";
      isShowingBadgePopup = true;
    }

    badgeModalOkBtn.addEventListener("click", () => {
      badgeModal.style.display = "none";
      isShowingBadgePopup = false;
      showNextBadgePopup();
    });

    // SESSION STORAGE
    function loadSessions() {
      const raw = localStorage.getItem("ubaidSessions");
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) return parsed;
        return [];
      } catch(e) {
        return [];
      }
    }

    function saveSessions(arr) {
      localStorage.setItem("ubaidSessions", JSON.stringify(arr));
    }

    function addSessionRecord(record) {
      const sessions = loadSessions();
      sessions.push(record);
      saveSessions(sessions);
    }

    function formatDateShort(isoString) {
      const d = new Date(isoString);
      if (isNaN(d)) return isoString;
      return d.toLocaleDateString("id-ID", {
        day: "2-digit",
        month: "short"
      });
    }

    function getCategoryLabel(cat) {
      switch (cat) {
        case "math": return "Math";
        case "science": return "Science";
        case "english": return "English";
        case "global": return "Global";
        case "indo": return "Bhs. Indonesia";
        case "paibp": return "PAIBP";
        case "pancasila": return "Pend. Pancasila";
        case "mix": return "Mix";
        default: return "Latihan";
      }
    }

    function scoreClass(percent) {
      if (percent < 50) return "low";
      if (percent < 80) return "mid";
      return "high";
    }

    function getPerfectScoreCount() {
      const sessions = loadSessions();
      return sessions.filter(s => s.percent === 100).length;
    }

    function updatePerfectScoreProgressUI() {
      if (!perfectScoreProgressEl) return;
      const count = getPerfectScoreCount();
      const maxTiers = 10;
      perfectScoreProgressEl.innerHTML = `Perfect Score: <strong>${Math.min(count, maxTiers)}/${maxTiers}</strong> sesi`;
    }

    function renderReport() {
      const sessions = loadSessions();
      if (!sessions.length) {
        reportSummary.textContent = "Belum ada sesi";
        reportChartInner.innerHTML = "";
        reportChartInner.appendChild(reportChartEmpty);
        reportChartEmpty.style.display = "block";

        reportTable.style.display = "none";
        reportTableBody.innerHTML = "";
        reportTableEmpty.style.display = "block";

        updatePerfectScoreProgressUI();
        return;
      }

      const lastSessions = sessions.slice(-10);
      const count = lastSessions.length;

      const avg =
        lastSessions.reduce((sum, s) => sum + (s.percent || 0), 0) / count;
      reportSummary.textContent =
        "Total sesi: " + sessions.length + " ‚Ä¢ Rata-rata: " + Math.round(avg) + "%";

      reportChartInner.innerHTML = "";
      reportChartEmpty.style.display = "none";

      lastSessions.forEach((s) => {
        const pct = s.percent || 0;
        const bar = document.createElement("div");
        bar.className = "report-bar " + scoreClass(pct);
        bar.style.height = Math.max(8, (pct / 100) * 150) + "px";

        const val = document.createElement("div");
        val.className = "report-bar-value";
        val.textContent = pct + "%";

        const label = document.createElement("div");
        label.className = "report-bar-label";
        label.textContent = formatDateShort(s.date);

        bar.appendChild(val);

        const wrapper = document.createElement("div");
        wrapper.style.flex = "1";
        wrapper.style.display = "flex";
        wrapper.style.flexDirection = "column";
        wrapper.style.alignItems = "center";
        wrapper.appendChild(bar);
        wrapper.appendChild(label);

        reportChartInner.appendChild(wrapper);
      });

      reportTableBody.innerHTML = "";
      lastSessions
        .slice()
        .reverse()
        .forEach((s) => {
          const tr = document.createElement("tr");

          const tdDate = document.createElement("td");
          tdDate.textContent =
            formatDateShort(s.date) + " " + (s.time || "");

          const tdCat = document.createElement("td");
          tdCat.textContent = getCategoryLabel(s.category);

          const tdScore = document.createElement("td");
          tdScore.textContent = (s.percent || 0) + "%";
          tdScore.className = "score-cell " + scoreClass(s.percent || 0);

          const tdDetail = document.createElement("td");
          tdDetail.textContent = s.correct + " / " + s.total;

          tr.appendChild(tdDate);
          tr.appendChild(tdCat);
          tr.appendChild(tdScore);
          tr.appendChild(tdDetail);

          reportTableBody.appendChild(tr);
        });

      reportTable.style.display = "table";
      reportTableEmpty.style.display = "none";

      updatePerfectScoreProgressUI();
    }

    function shuffleArray(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function startQuiz() {
      const cat = categorySelect.value;
      const count = parseInt(questionCountSelect.value, 10);

      currentCategory = cat;

      let questions;
      if (cat === "mix") {
        questions = getMixedQuestions();
      } else {
        questions = questionBank[cat] || [];
      }

      if (!questions.length) {
        alert("Belum ada soal untuk kategori ini.");
        return;
      }

      const shuffled = shuffleArray(questions);
      currentQuestions = shuffled.slice(0, Math.min(count, shuffled.length));

      currentIndex = 0;
      sessionCorrect = 0;
      answeredCount = 0;
      skippedCount = 0;
      isQuestionLocked = false;

      scoreDisplay.textContent = "0";
      feedback.textContent = "";
      feedback.className = "feedback";
      nextBtn.disabled = true;

      emptyState.style.display = "none";
      quizCard.style.display = "block";
      resultCard.style.display = "none";
      resultModal.style.display = "none";

      categoryTag.textContent = getCategoryLabel(cat);

      startingLevel = getLevelInfo(totalXP).level;

      updateProgress();
      renderQuestion();
    }

    function updateProgress() {
      const total = currentQuestions.length;
      const done = answeredCount + skippedCount;
      const percent = total > 0 ? (done / total) * 100 : 0;

      progressFill.style.width = percent + "%";
      progressLabel.textContent = Math.round(percent) + "% complete";
      answeredLabel.textContent = answeredCount + " answered";
      questionTag.textContent = "Question " + (currentIndex + 1) + " of " + total;

      quizTitle.textContent =
        currentIndex === 0
          ? "Fokus sebentar, lalu kita rayakan skornya! üéâ"
          : "Mantap, lanjut lagi! üöÄ";
    }

    function renderQuestion() {
      const q = currentQuestions[currentIndex];
      if (!q) return;

      const type = q.type || "choice";

      isQuestionLocked = false;
      feedback.textContent = "";
      feedback.className = "feedback";
      nextBtn.disabled = true;

      questionText.textContent = q.question;

      if (q.image) {
        questionImageContainer.innerHTML =
          '<img src="' + q.image + '" alt="Question image" />';
        questionImageContainer.style.display = "block";
      } else {
        questionImageContainer.innerHTML = "";
        questionImageContainer.style.display = "none";
      }

      optionsContainer.innerHTML = "";
      optionsContainer.style.display = "none";
      optionsContainer.classList.remove("image-grid");
      inputContainer.style.display = "none";

      if (type === "choice") {
        renderChoiceQuestion(q);
      } else if (type === "choiceImage") {
        renderImageChoiceQuestion(q);
      } else if (type === "input" || type === "input3") {
        renderInputQuestion(q);
      }
    }

    function renderChoiceQuestion(q) {
      optionsContainer.style.display = "flex";

      const labels = ["A", "B", "C", "D", "E", "F"];

      q.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.innerHTML = `
          <span class="option-label">${labels[index] || "?"}</span>
          <span class="option-text">${opt}</span>
        `;
        btn.addEventListener("click", () => handleOptionClick(index));
        optionsContainer.appendChild(btn);
      });
    }

    function renderImageChoiceQuestion(q) {
      optionsContainer.style.display = "grid";
      optionsContainer.classList.add("image-grid");
      optionsContainer.innerHTML = "";

      q.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        btn.className = "option-btn image-option";

        btn.innerHTML = `
          <div class="option-img-wrapper">
            <img src="${opt.image}" alt="Option ${index + 1}">
          </div>
          ${opt.caption ? `<div class="option-caption">${opt.caption}</div>` : ""}
        `;

        btn.addEventListener("click", () => handleOptionClick(index));
        optionsContainer.appendChild(btn);
      });
    }

    function renderInputQuestion(q) {
      inputContainer.style.display = "flex";

      const isTriple = q.type === "input3";

      const labels = q.labels || (isTriple ? ["X", "Y", "Z"] : ["Answer", "Y", "Z"]);
      label1.textContent = labels[0] || (isTriple ? "X" : "Answer");
      label2.textContent = labels[1] || "Y";
      label3.textContent = labels[2] || "Z";

      group2.style.display = isTriple ? "flex" : "none";
      group3.style.display = isTriple ? "flex" : "none";

      input1.value = "";
      input2.value = "";
      input3.value = "";

      input1.disabled = false;
      input2.disabled = false;
      input3.disabled = false;
      checkInputBtn.disabled = false;

      input1.focus();
    }

    function handleOptionClick(selectedIndex) {
      if (isQuestionLocked) return;

      const currentQuestion = currentQuestions[currentIndex];
      const optionButtons = Array.from(
        document.querySelectorAll(".option-btn")
      );

      isQuestionLocked = true;
      answeredCount++;

      optionButtons.forEach((btn, idx) => {
        btn.disabled = true;
        if (idx === currentQuestion.answerIndex) {
          btn.classList.add("correct");
        }
        if (idx === selectedIndex && selectedIndex !== currentQuestion.answerIndex) {
          btn.classList.add("wrong");
        }
      });

      if (selectedIndex === currentQuestion.answerIndex) {
        sessionCorrect++;
        scoreDisplay.textContent = sessionCorrect;

        // XP +1
        totalXP++;
        localStorage.setItem("ubaidXP", String(totalXP));
        updateXPUI(getLevelInfo(totalXP));

        // COINS +50 (hanya soal utama)
        totalCoins += 50;
        localStorage.setItem("ubaidCoins", String(totalCoins));
        updateCoinUI();

        feedback.textContent = "Benar! " + (currentQuestion.explanation || "");
        feedback.className = "feedback correct";
      } else {
        feedback.textContent =
          "Belum tepat. " +
          (currentQuestion.explanation
            ? "Penjelasan: " + currentQuestion.explanation
            : "");
        feedback.className = "feedback wrong";
      }

      updateProgress();
      nextBtn.disabled = false;
      nextBtn.textContent =
        currentIndex === currentQuestions.length - 1
          ? "Lihat Hasil üèÅ"
          : "Berikutnya ‚ûú";
    }

    function normalize(str) {
      return str.toString().trim().toLowerCase();
    }

    function handleInputSubmit() {
      if (isQuestionLocked) return;
      const q = currentQuestions[currentIndex];
      if (!q) return;

      if (q.type === "input3") {
        handleInput3Submit(q);
      } else {
        handleSingleInput(q);
      }
    }

    function handleSingleInput(q) {
      let userAnswer = input1.value.trim();
      if (!userAnswer) {
        feedback.textContent = "Tulis dulu jawabannya, ya üòä";
        feedback.className = "feedback wrong";
        return;
      }

      const normalizedUser = normalize(userAnswer);
      let correctAnswers = [];

      if (Array.isArray(q.correctAnswers)) {
        correctAnswers = q.correctAnswers;
      } else if (
        typeof q.correctAnswers === "string" ||
        typeof q.correctAnswers === "number"
      ) {
        correctAnswers = [q.correctAnswers];
      }

      const isCorrect = correctAnswers.some(
        (ans) => normalize(ans) === normalizedUser
      );

      isQuestionLocked = true;
      answeredCount++;

      input1.disabled = true;
      input2.disabled = true;
      input3.disabled = true;
      checkInputBtn.disabled = true;

      if (isCorrect) {
        sessionCorrect++;
        scoreDisplay.textContent = sessionCorrect;

        // XP +1
        totalXP++;
        localStorage.setItem("ubaidXP", String(totalXP));
        updateXPUI(getLevelInfo(totalXP));

        // COINS +50
        totalCoins += 50;
        localStorage.setItem("ubaidCoins", String(totalCoins));
        updateCoinUI();

        feedback.textContent = "Benar! " + (q.explanation || "");
        feedback.className = "feedback correct";
      } else {
        const correctShow = correctAnswers[0] ?? "";
        feedback.textContent =
          "Belum tepat. " +
          (correctShow ? "Jawaban benar: " + correctShow + ". " : "") +
          (q.explanation || "");
        feedback.className = "feedback wrong";
      }

      updateProgress();
      nextBtn.disabled = false;
      nextBtn.textContent =
        currentIndex === currentQuestions.length - 1
          ? "Lihat Hasil üèÅ"
          : "Berikutnya ‚ûú";
    }

    function handleInput3Submit(q) {
      const a1 = normalize(input1.value);
      const a2 = normalize(input2.value);
      const a3 = normalize(input3.value);

      if (!a1 || !a2 || !a3) {
        feedback.textContent = "Semua kolom X, Y, dan Z harus diisi ya üòä";
        feedback.className = "feedback wrong";
        return;
      }

      function isCorrectInput(user, validList) {
        return validList.some((v) => normalize(v) === user);
      }

      const correct1 = isCorrectInput(a1, q.correctAnswers[0]);
      const correct2 = isCorrectInput(a2, q.correctAnswers[1]);
      const correct3 = isCorrectInput(a3, q.correctAnswers[2]);

      isQuestionLocked = true;
      answeredCount++;

      input1.disabled = true;
      input2.disabled = true;
      input3.disabled = true;
      checkInputBtn.disabled = true;

      if (correct1 && correct2 && correct3) {
        sessionCorrect++;
        scoreDisplay.textContent = sessionCorrect;

        // XP +1
        totalXP++;
        localStorage.setItem("ubaidXP", String(totalXP));
        updateXPUI(getLevelInfo(totalXP));

        // COINS +50
        totalCoins += 50;
        localStorage.setItem("ubaidCoins", String(totalCoins));
        updateCoinUI();

        feedback.textContent = "Benar! " + (q.explanation || "");
        feedback.className = "feedback correct";
      } else {
        feedback.textContent =
          "Belum tepat. " + (q.explanation || "");
        feedback.className = "feedback wrong";
      }

      updateProgress();
      nextBtn.disabled = false;
      nextBtn.textContent =
        currentIndex === currentQuestions.length - 1
          ? "Lihat Hasil üèÅ"
          : "Berikutnya ‚ûú";
    }

    function goToNextQuestion() {
      if (currentIndex >= currentQuestions.length - 1) {
        showResult();
        return;
      }
      currentIndex++;
      updateProgress();
      renderQuestion();
    }

    function skipQuestion() {
      if (isQuestionLocked) {
        goToNextQuestion();
        return;
      }
      skippedCount++;

      if (currentIndex >= currentQuestions.length - 1) {
        showResult();
      } else {
        currentIndex++;
        updateProgress();
        renderQuestion();
      }
    }

    function showResult() {
      const totalQuestions = currentQuestions.length;
      const correctCount = sessionCorrect;
      const wrongCount = totalQuestions - correctCount - skippedCount;

      const percent =
        totalQuestions > 0
          ? Math.round((correctCount / totalQuestions) * 100)
          : 0;
      const finalScore = percent;
  const coinsEarned = correctCount * 50; // 1 jawaban benar = 50 coins
      const now = new Date();
      const dateIso = now.toISOString();
      const timeLabel = now.toLocaleTimeString("id-ID", {
        hour: "2-digit",
        minute: "2-digit"
      });

      const record = {
        date: dateIso,
        time: timeLabel,
        category: currentCategory,
        questions: totalQuestions,
        correct: correctCount,
        wrong: wrongCount,
        skipped: skippedCount,
        percent: finalScore,
        total: totalQuestions
      };

      addSessionRecord(record);

      totalAnsweredAllTime += totalQuestions;
      saveTotalAnswered();

      const sessions = loadSessions();

      const newlyUnlockedNames = [];
      function tryUnlock(id, condition) {
        if (!condition) return;
        if (unlockBadge(id)) {
          const cfg = getBadgeConfigById(id);
          if (cfg) {
            newlyUnlockedNames.push(cfg.name);
            badgeQueue.push(id);
          }
        }
      }

      const perfectCount = sessions.filter(s => s.percent === 100).length;

      tryUnlock("perfectScore1", perfectCount >= 1);
      tryUnlock("perfectScore3", perfectCount >= 3);
      tryUnlock("perfectScore5", perfectCount >= 5);
      tryUnlock("perfectScore10", perfectCount >= 10);

      tryUnlock("mathMaster90", currentCategory === "math" && finalScore >= 90);
      tryUnlock("scienceHero90", currentCategory === "science" && finalScore >= 90);
      tryUnlock("englishChampion90", currentCategory === "english" && finalScore >= 90);

      renderReport();
      updateRobotLabUI();

      resultScore.textContent = finalScore;
      resultMaxScore.textContent = "100";
      resultCorrect.textContent = correctCount;
      resultWrong.textContent = wrongCount;
      resultSkipped.textContent = skippedCount;
      resultPercent.textContent = finalScore + "%";

      const levelInfo = getLevelInfo(totalXP);
      updateXPUI(levelInfo);
      const newLevel = levelInfo.level;
      const leveledUp = newLevel > startingLevel;

      let title, msg, emoji;
      if (finalScore === 100) {
        emoji = "üåü";
        title = "Perfect! Math & Science Hero! üî•";
        msg = "Semua soal benar! Ulangi atau naikkan jumlah soalnya untuk tantangan baru.";
      } else if (finalScore >= 80) {
        emoji = "üèÜ";
        title = "Keren banget! üí™";
        msg = "Nilaimu sudah tinggi. Coba cek lagi soal-soal yang masih salah, ya.";
      } else if (finalScore >= 50) {
        emoji = "üöÄ";
        title = "Lumayan, kita push lagi!";
        msg = "Belajar itu pelan-pelan tapi rutin. Ulangi sesi ini supaya makin kuat.";
      } else {
        emoji = "üå±";
        title = "Awal yang bagus untuk mulai! üôÇ";
        msg = "Tidak apa-apa kalau masih banyak salah. Kita bisa mulai dari materi mudah dulu.";
      }

      if (leveledUp) {
        msg += ` üéâ Kamu naik ke Level ${newLevel}: ${levelInfo.title}!`;
      }

      if (newlyUnlockedNames.length > 0) {
        msg += ` üèÖ Badge baru: ${newlyUnlockedNames.join(", ")}.`;
      }

      emojiResult.textContent = emoji;
      resultTitle.textContent = title;
      resultMessage.textContent = msg;

      modalEmoji.textContent = emoji;
      modalScore.innerHTML = finalScore + "<span>%</span>";
      modalMessageShort.textContent = title;
      modalCorrect.textContent = correctCount;
      modalWrong.textContent = wrongCount;
      modalSkipped.textContent = skippedCount;
  // Update tampilan coins sesi ini
  if (modalCoinValue) {
    modalCoinValue.textContent = "+ " + coinsEarned;
  }
  if (modalCoinExplain) {
    modalCoinExplain.textContent =
      correctCount + " soal benar √ó 50 coins = " + coinsEarned + " coins";
  }
      quizCard.style.display = "none";
      resultCard.style.display = "none";
      resultModal.style.display = "flex";

      showNextBadgePopup();
    }

    function resetToStart() {
      quizCard.style.display = "none";
      resultCard.style.display = "none";
      resultModal.style.display = "none";
      emptyState.style.display = "flex";
      showHome();
    }

    function retrySameQuiz() {
      if (!currentQuestions || !currentQuestions.length) {
        resetToStart();
        return;
      }

      currentQuestions = shuffleArray(currentQuestions);
      currentIndex = 0;
      sessionCorrect = 0;
      answeredCount = 0;
      skippedCount = 0;
      isQuestionLocked = false;

      scoreDisplay.textContent = "0";
      feedback.textContent = "";
      feedback.className = "feedback";
      nextBtn.disabled = true;

      resultCard.style.display = "none";
      resultModal.style.display = "none";
      quizCard.style.display = "block";

      startingLevel = getLevelInfo(totalXP).level;

      updateProgress();
      renderQuestion();
    }

    // ROBOT LAB
    function updateRobotLabUI() {
      const levelInfo = getLevelInfo(totalXP);
      robotLabEmoji.textContent = levelInfo.emoji;
      robotLabLevelTitle.textContent = `Lv. ${levelInfo.level} ‚Äî ${levelInfo.title}`;

      const sessions = loadSessions();
      const perfectCount = getPerfectScoreCount();

      statTotalXP.textContent = totalXP;
      statTotalSessions.textContent = sessions.length;
      statPerfectScore.textContent = perfectCount;

      robotLabXPLabel.textContent = totalXP + " XP";

      const currentLevelIndex = LEVELS.findIndex(l => l.level === levelInfo.level);
      const nextLevelConfig = LEVELS[currentLevelIndex + 1];

      if (nextLevelConfig) {
        robotLabNextLevel.textContent = `Next upgrade: ${nextLevelConfig.minXP} XP`;
      } else {
        robotLabNextLevel.textContent = "Max level reached üöÄ";
      }

      const spanXP = levelInfo.maxXP - levelInfo.minXP || 1;
      const percent = Math.min(
        ((totalXP - levelInfo.minXP) / spanXP) * 100,
        100
      );
      robotLabXPFill.style.width = percent + "%";

      robotLabUpgradeList.innerHTML = "";
      LEVELS.forEach(lvl => {
        const unlocked = totalXP >= lvl.minXP;
        const div = document.createElement("div");
        div.className = "robotlab-upgrade-item" + (unlocked ? "" : " upgrade-locked");
        div.innerHTML = `
          <div class="upgrade-icon">${lvl.emoji}</div>
          <div class="upgrade-info">
            <div class="upgrade-name">Lv. ${lvl.level} ‚Äî ${lvl.title}</div>
            <div class="upgrade-status">
              ${unlocked ? "Unlocked ‚úî" : `Locked ‚Äî ${lvl.minXP} XP needed`}
            </div>
          </div>
        `;
        robotLabUpgradeList.appendChild(div);
      });
    }

    // NAV
    function showHome() {
      navHome.classList.add("active");
      navReport.classList.remove("active");
      navRobotLab.classList.remove("active");

      homeSection.style.display = "block";
      reportSection.style.display = "none";
      robotLabSection.style.display = "none";
    }

    function showReport() {
      navHome.classList.remove("active");
      navReport.classList.add("active");
      navRobotLab.classList.remove("active");

      homeSection.style.display = "none";
      reportSection.style.display = "block";
      robotLabSection.style.display = "none";

      renderReport();
    }

    function showRobotLab() {
      navHome.classList.remove("active");
      navReport.classList.remove("active");
      navRobotLab.classList.add("active");

      homeSection.style.display = "none";
      reportSection.style.display = "none";
      robotLabSection.style.display = "block";

      updateRobotLabUI();
    }

    // ==============================
    // SPEED MATH (BRAIN GAMES)
    // ==============================
    function loadSpeedMathHighScore() {
      const raw = localStorage.getItem("ubaidSpeedMathHighScore");
      smHighScore = raw ? parseInt(raw, 10) || 0 : 0;
      smHighScoreEl.textContent = smHighScore;
    }

    function saveSpeedMathHighScore() {
      localStorage.setItem("ubaidSpeedMathHighScore", String(smHighScore));
    }

    function openSpeedMath() {
      speedMathModal.style.display = "flex";
      smFeedback.textContent = "";
      smFeedback.className = "sm-feedback";
      smQuestionEl.textContent = "Tekan Start untuk mulai.";
      smAnswerInput.value = "";
      smAnswerInput.disabled = true;
      smSubmitBtn.disabled = true;
      smStartBtn.disabled = false;
      smTimerEl.textContent = "60s";
      smScoreEl.textContent = "0";
      smTimeLeft = 60;
      smScore = 0;
    }

    function closeSpeedMath() {
      speedMathModal.style.display = "none";
      if (smTimerInterval) {
        clearInterval(smTimerInterval);
        smTimerInterval = null;
      }
      smInProgress = false;
    }

    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // NOTE: kalau mau hanya + / - , ubah ops jadi ["+","-"] dan hapus case √ó, √∑
    function generateSpeedMathQuestion() {
      const ops = ["+", "-"];
      const op = ops[randomInt(0, ops.length - 1)];
      let a, b, question, answer;

      switch (op) {
        case "+":
          a = randomInt(1, 50);
          b = randomInt(1, 50);
          answer = a + b;
          question = `${a} + ${b} = ?`;
          break;
        case "-":
          a = randomInt(1, 50);
          b = randomInt(1, 50);
          if (b > a) [a, b] = [b, a];
          answer = a - b;
          question = `${a} - ${b} = ?`;
          break;
        case "√ó":
          a = randomInt(2, 12);
          b = randomInt(2, 12);
          answer = a * b;
          question = `${a} √ó ${b} = ?`;
          break;
        case "√∑":
          b = randomInt(2, 12);
          const q = randomInt(2, 12);
          a = b * q;
          answer = q;
          question = `${a} √∑ ${b} = ?`;
          break;
      }

      smCurrentAnswer = answer;
      smQuestionEl.textContent = question;
    }

    function startSpeedMath() {
      smTimeLeft = 60;
      smScore = 0;
      smScoreEl.textContent = "0";
      smTimerEl.textContent = "60s";
      smFeedback.textContent = "";
      smFeedback.className = "sm-feedback";

      smInProgress = true;
      smStartBtn.disabled = true;
      smSubmitBtn.disabled = false;
      smAnswerInput.disabled = false;
      smAnswerInput.value = "";
      smAnswerInput.focus();

      if (smTimerInterval) {
        clearInterval(smTimerInterval);
      }

      generateSpeedMathQuestion();

      smTimerInterval = setInterval(() => {
        smTimeLeft--;
        smTimerEl.textContent = smTimeLeft + "s";
        if (smTimeLeft <= 0) {
          endSpeedMath();
        }
      }, 1000);
    }

    function handleSpeedMathSubmit() {
      if (!smInProgress) return;

      const raw = smAnswerInput.value.trim();
      if (!raw) {
        smFeedback.textContent = "Isi dulu jawabannya üòä";
        smFeedback.className = "sm-feedback wrong";
        return;
      }

      const userAnswer = parseInt(raw, 10);
      if (Number.isNaN(userAnswer)) {
        smFeedback.textContent = "Jawaban harus angka ya.";
        smFeedback.className = "sm-feedback wrong";
        return;
      }

      if (userAnswer === smCurrentAnswer) {
        smScore++;
        smScoreEl.textContent = smScore;
        smFeedback.textContent = "Benar! Lanjut üí™";
        smFeedback.className = "sm-feedback correct";

        // Speed Math hanya menambah XP, tidak koin
        totalXP++;
        localStorage.setItem("ubaidXP", String(totalXP));
        updateXPUI(getLevelInfo(totalXP));
      } else {
        smFeedback.textContent = "Belum tepat, coba soal berikutnya.";
        smFeedback.className = "sm-feedback wrong";
      }

      smAnswerInput.value = "";
      smAnswerInput.focus();
      if (smTimeLeft > 0) {
        generateSpeedMathQuestion();
      }
    }

    function endSpeedMath() {
      if (!smInProgress) return;
      smInProgress = false;
      smSubmitBtn.disabled = true;
      smStartBtn.disabled = false;
      smAnswerInput.disabled = true;
      if (smTimerInterval) {
        clearInterval(smTimerInterval);
        smTimerInterval = null;
      }
      smTimerEl.textContent = "0s";

      if (smScore > smHighScore) {
        smHighScore = smScore;
        saveSpeedMathHighScore();
        smHighScoreEl.textContent = smHighScore;
        smFeedback.textContent = `Waktu habis! Skor: ${smScore} (Best baru! üéâ)`;
      } else {
        smFeedback.textContent = `Waktu habis! Skor: ${smScore}.`;
      }
      smFeedback.className = "sm-feedback";

      updateRobotLabUI();
    }

    // ==============================
    // MEMORY GRID (4 KOTAK, PILIHAN GANDA)
    // ==============================
    function loadMemoryGridBest() {
      const raw = localStorage.getItem("ubaidMemoryGridBest");
      mgBestScore = raw ? parseInt(raw, 10) || 0 : 0;
      mgBestLabel.textContent = mgBestScore;
    }

    function saveMemoryGridBest() {
      localStorage.setItem("ubaidMemoryGridBest", String(mgBestScore));
    }

    function openMemoryGrid() {
      memoryGridModal.style.display = "flex";
      mgFeedback.textContent = "";
      mgFeedback.className = "sm-feedback";
      mgQuestion.textContent = "Tekan Start untuk mulai.";
      mgOptionsContainer.innerHTML = "";
      mgRoundLabel.textContent = `0/${mgTotalRounds}`;
      mgScoreLabel.textContent = "0";
      mgCells.forEach(cell => cell.textContent = "");
      mgStartBtn.disabled = false;
      mgNextBtn.disabled = true;
      mgPhase = "idle";
      if (mgTimeoutId) {
        clearTimeout(mgTimeoutId);
        mgTimeoutId = null;
      }
    }

    function closeMemoryGrid() {
      memoryGridModal.style.display = "none";
      if (mgTimeoutId) {
        clearTimeout(mgTimeoutId);
        mgTimeoutId = null;
      }
      mgPhase = "idle";
    }

    function startMemoryGridGame() {
      mgScore = 0;
      mgCurrentRound = 0;
      mgScoreLabel.textContent = mgScore;
      mgRoundLabel.textContent = `0/${mgTotalRounds}`;
      mgFeedback.textContent = "";
      mgFeedback.className = "sm-feedback";
      mgOptionsContainer.innerHTML = "";
      mgStartBtn.disabled = true;
      mgNextBtn.disabled = true;
      startMemoryGridRound();
    }

    function startMemoryGridRound() {
      mgCurrentRound++;
      if (mgCurrentRound > mgTotalRounds) {
        mgPhase = "done";
        mgStartBtn.disabled = false;
        mgNextBtn.disabled = true;
        mgFeedback.textContent += " Game selesai! üëè";
        mgFeedback.className = "sm-feedback";
        return;
      }

      mgRoundLabel.textContent = `${mgCurrentRound}/${mgTotalRounds}`;
      mgPhase = "show";
      mgOptionsContainer.innerHTML = "";
      mgFeedback.textContent = "Perhatikan angka di setiap kotak...";
      mgFeedback.className = "sm-feedback";
      mgQuestion.textContent = "Hafalkan posisi angkanya...";

      // generate 4 unique numbers 10‚Äì99
      mgNumbers = [];
      while (mgNumbers.length < 4) {
        const n = randomInt(1, 19);
        if (!mgNumbers.includes(n)) mgNumbers.push(n);
      }

      mgTargetIndex = randomInt(0, 3);
      mgCorrectNumber = mgNumbers[mgTargetIndex];

      mgCells.forEach((cell, idx) => {
        cell.textContent = mgNumbers[idx];
      });

      if (mgTimeoutId) {
        clearTimeout(mgTimeoutId);
      }
      mgTimeoutId = setTimeout(showMemoryGridQuestionPhase, 3000);
    }

    function showMemoryGridQuestionPhase() {
      mgPhase = "question";
      mgCells.forEach(cell => {
        cell.textContent = "?";
      });

      mgQuestion.textContent = `Which number was in box ${mgTargetIndex + 1}?`;
      mgFeedback.textContent = "";
      mgFeedback.className = "sm-feedback";

      const optSet = new Set();
      optSet.add(mgCorrectNumber);
      while (optSet.size < 4) {
        const n = randomInt(1, 19);
        if (!optSet.has(n)) optSet.add(n);
      }
      const options = shuffleArray(Array.from(optSet));

      mgOptionsContainer.innerHTML = "";
      const labels = ["A", "B", "C", "D"];
      options.forEach((num, index) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.innerHTML = `
          <span class="option-label">${labels[index]}</span>
          <span class="option-text">${num}</span>
        `;
        btn.addEventListener("click", () => handleMemoryGridAnswer(num, btn));
        mgOptionsContainer.appendChild(btn);
      });

      mgNextBtn.disabled = true;
    }

    function handleMemoryGridAnswer(selectedNumber, clickedBtn) {
      if (mgPhase !== "question") return;
      mgPhase = "answer";

      const buttons = Array.from(mgOptionsContainer.querySelectorAll(".option-btn"));
      buttons.forEach(btn => {
        btn.disabled = true;
        const val = parseInt(btn.querySelector(".option-text").textContent, 10);
        if (val === mgCorrectNumber) {
          btn.classList.add("correct");
        }
        if (btn === clickedBtn && val !== mgCorrectNumber) {
          btn.classList.add("wrong");
        }
      });

      if (selectedNumber === mgCorrectNumber) {
        mgScore++;
        mgScoreLabel.textContent = mgScore;
        mgFeedback.textContent = "Benar! üëè";
        mgFeedback.className = "sm-feedback correct";

        // Memory Grid: hanya tambah XP, tidak koin
        totalXP++;
        localStorage.setItem("ubaidXP", String(totalXP));
        updateXPUI(getLevelInfo(totalXP));
      } else {
        mgFeedback.textContent = `Belum tepat. Yang benar: ${mgCorrectNumber}.`;
        mgFeedback.className = "sm-feedback wrong";
      }

      if (mgScore > mgBestScore) {
        mgBestScore = mgScore;
        mgBestLabel.textContent = mgBestScore;
        saveMemoryGridBest();
      }

      if (mgCurrentRound < mgTotalRounds) {
        mgNextBtn.disabled = false;
      } else {
        mgNextBtn.disabled = true;
        mgStartBtn.disabled = false;
        mgFeedback.textContent += " Game selesai! üëè";
        mgPhase = "done";
      }

      updateRobotLabUI();
    }

    // REWARD HISTORY STORAGE
    function loadRewardHistory() {
      const raw = localStorage.getItem("ubaidRewardHistory");
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        return [];
      }
    }

    function saveRewardHistory(arr) {
      localStorage.setItem("ubaidRewardHistory", JSON.stringify(arr));
    }

    function renderRewardShop() {
      if (!rewardListEl) return;

      rewardListEl.innerHTML = "";
      REWARDS.forEach(reward => {
        const item = document.createElement("div");
        item.className = "reward-item";

        const affordable = totalCoins >= reward.cost;

        item.innerHTML = `
          <div class="reward-icon">üéÅ</div>
          <div class="reward-main">
            <div class="reward-name">${reward.name}</div>
            <div class="reward-desc">${reward.desc}</div>
            <div class="reward-cost">Cost: ${reward.cost} coins</div>
          </div>
        `;

        const btn = document.createElement("button");
        btn.className = "reward-btn";
        btn.textContent = affordable ? "Redeem" : "Need more coins";
        btn.disabled = !affordable;
        btn.addEventListener("click", () => redeemReward(reward.id));

        item.appendChild(btn);
        rewardListEl.appendChild(item);
      });
    }

    function renderRewardHistory() {
      if (!rewardHistoryEl) return;

      if (!rewardHistory.length) {
        rewardHistoryEl.textContent = "Belum ada penukaran.";
        return;
      }

      rewardHistoryEl.innerHTML = "";
      rewardHistory
        .slice()
        .reverse()
        .forEach(entry => {
          const div = document.createElement("div");
          div.className = "reward-history-item";
          div.textContent = `${entry.date} ‚Äî ${entry.name} (${entry.cost} coins)`;
          rewardHistoryEl.appendChild(div);
        });
    }

    function openRewardShop() {
      if (rewardShopModal) {
        renderRewardShop();
        renderRewardHistory();
        rewardShopModal.style.display = "flex";
      }
    }

    function closeRewardShop() {
      if (rewardShopModal) {
        rewardShopModal.style.display = "none";
      }
    }

    function redeemReward(rewardId) {
      const reward = REWARDS.find(r => r.id === rewardId);
      if (!reward) return;

      if (totalCoins < reward.cost) {
        alert("Koin belum cukup untuk reward ini.");
        return;
      }

      const ok = confirm(
        `Tukar ${reward.cost} coins untuk:\n\n"${reward.name}"?\n\nSetelah ditekan OK, orang tua memberikan hadiah ini di dunia nyata.`
      );
      if (!ok) return;

      totalCoins -= reward.cost;
      localStorage.setItem("ubaidCoins", String(totalCoins));
      updateCoinUI();
      renderRewardShop();

      const now = new Date();
      const dateStr = now.toLocaleString("id-ID", {
        day: "2-digit",
        month: "short",
        hour: "2-digit",
        minute: "2-digit"
      });

      rewardHistory.push({
        id: reward.id,
        name: reward.name,
        cost: reward.cost,
        date: dateStr
      });
      saveRewardHistory(rewardHistory);
      renderRewardHistory();

      alert(`Berhasil ditukar! Jangan lupa berikan "${reward.name}" ke Ubaid üéÅ`);
    }

    // EVENT LISTENERS
    startBtn.addEventListener("click", startQuiz);
    nextBtn.addEventListener("click", goToNextQuestion);
    skipBtn.addEventListener("click", skipQuestion);
    backToStartBtn.addEventListener("click", resetToStart);
    retryBtn.addEventListener("click", retrySameQuiz);
    checkInputBtn.addEventListener("click", handleInputSubmit);

    [input1, input2, input3].forEach((el) => {
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          handleInputSubmit();
        }
      });
    });

    modalRetryBtn.addEventListener("click", retrySameQuiz);
    modalCloseBtn.addEventListener("click", resetToStart);

    navHome.addEventListener("click", showHome);
    navReport.addEventListener("click", showReport);
    navRobotLab.addEventListener("click", showRobotLab);

    // Brain Games - Speed Math
    brainGamesTile.addEventListener("click", openSpeedMath);
    smStartBtn.addEventListener("click", startSpeedMath);
    smSubmitBtn.addEventListener("click", handleSpeedMathSubmit);
    smCloseBtn.addEventListener("click", () => {
      if (smInProgress) {
        if (!confirm("Speed Math masih berjalan. Yakin mau keluar?")) return;
      }
      closeSpeedMath();
    });
    smAnswerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSpeedMathSubmit();
      }
    });

    // Brain Games - Memory Grid
    memoryGridTile.addEventListener("click", openMemoryGrid);
    mgStartBtn.addEventListener("click", startMemoryGridGame);
    mgNextBtn.addEventListener("click", () => {
      if (mgPhase === "answer" && mgCurrentRound < mgTotalRounds) {
        startMemoryGridRound();
      }
    });
    mgCloseBtn.addEventListener("click", () => {
      if (mgPhase === "show" || mgPhase === "question") {
        if (!confirm("Game masih berjalan. Yakin mau keluar?")) return;
      }
      closeMemoryGrid();
    });

    // Reward Shop
    if (rewardShopTile) {
      rewardShopTile.addEventListener("click", openRewardShop);
    }
    if (rewardCloseBtn) {
      rewardCloseBtn.addEventListener("click", closeRewardShop);
    }

    // INIT
    initXP();
    initCoins();
    unlockedBadges = loadBadges();
    initTotalAnswered();
    rewardHistory = loadRewardHistory();
    renderBadges();
    renderReport();
    loadSpeedMathHighScore();
    loadMemoryGridBest();
    updateRobotLabUI();
  </script>
</body>
</html>